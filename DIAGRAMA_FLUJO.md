# Diagrama de Flujo - DOF Alertas

## Flujo Visual Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚                         ğŸ• TRIGGER: Vercel Cron Job                         â”‚
â”‚                         Todos los dÃ­as a las 7:00 AM                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  ğŸ“¥ FASE 1: SCRAPING DEL DOF                                                â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1.1 Construir URL                                                   â”‚   â”‚
â”‚  â”‚     https://dof.gob.mx/index.php?year=2025&month=12&day=13         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                               â”‚
â”‚                            â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1.2 Descargar HTML                                                  â”‚   â”‚
â”‚  â”‚     fetch(url) â†’ HTML completo de la pÃ¡gina                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                               â”‚
â”‚                            â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1.3 Parsear con Cheerio                                            â”‚   â”‚
â”‚  â”‚     Buscar: a[href*="nota_dof.php"]                                 â”‚   â”‚
â”‚  â”‚     Extraer: tÃ­tulo, URL, tipo, ediciÃ³n                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                               â”‚
â”‚                            â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1.4 Para cada documento:                                            â”‚   â”‚
â”‚  â”‚     â€¢ Descargar contenido completo                                  â”‚   â”‚
â”‚  â”‚     â€¢ Extraer primeros 2000 caracteres                              â”‚   â”‚
â”‚  â”‚     â€¢ Limpiar texto (espacios, saltos de lÃ­nea)                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                               â”‚
â”‚                            â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 1.5 Guardar en Firestore                                            â”‚   â”‚
â”‚  â”‚     Collection: documentos_dof                                      â”‚   â”‚
â”‚  â”‚     Fields:                                                         â”‚   â”‚
â”‚  â”‚       - fecha_publicacion                                           â”‚   â”‚
â”‚  â”‚       - titulo                                                      â”‚   â”‚
â”‚  â”‚       - tipo_documento                                              â”‚   â”‚
â”‚  â”‚       - url_dof                                                     â”‚   â”‚
â”‚  â”‚       - contenido_extracto                                          â”‚   â”‚
â”‚  â”‚       - edicion                                                     â”‚   â”‚
â”‚  â”‚       - procesado: false  â† Pendiente de clasificaciÃ³n              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“Š OUTPUT: ~47 documentos guardados                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  ğŸ¤– FASE 2: CLASIFICACIÃ“N CON IA                                            â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                          â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2.1 Query Firestore                                                 â”‚   â”‚
â”‚  â”‚     WHERE procesado = false                                         â”‚   â”‚
â”‚  â”‚     LIMIT 50                                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                               â”‚
â”‚                            â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 2.2 Para cada documento:                                            â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚     â”‚ Construir Prompt                                     â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ "Analiza este documento del DOF de MÃ©xico.          â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚  TÃTULO: [tÃ­tulo del documento]                     â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚  EXTRACTO: [primeros 2000 caracteres]               â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚  Identifica Ã¡reas del derecho y genera resumen      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚  ejecutivo de 2-3 oraciones.                        â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚  Ãreas vÃ¡lidas: fiscal, laboral, mercantil..."      â”‚       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                        â”‚                                           â”‚   â”‚
â”‚  â”‚                        â–¼                                           â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚     â”‚ Enviar a Claude 3.5 Haiku                            â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Model: claude-3-5-haiku-20241022                     â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Max tokens: 300                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Tiempo: ~2-3 segundos                                â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Costo: $0.006                                        â”‚       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                        â”‚                                           â”‚   â”‚
â”‚  â”‚                        â–¼                                           â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚     â”‚ Respuesta de Claude (JSON)                           â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ {                                                    â”‚       â”‚   â”‚
â”‚  â”‚     â”‚   "areas": ["fiscal", "laboral"],                    â”‚       â”‚   â”‚
â”‚  â”‚     â”‚   "resumen": "Se reforman disposiciones de la        â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                Ley del ISR en materia de             â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                deducciones personales. Los           â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                cambios buscan ampliar el monto       â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                deducible. Entra en vigor 2026."      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ }                                                    â”‚       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                        â”‚                                           â”‚   â”‚
â”‚  â”‚                        â–¼                                           â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚     â”‚ Validar y Parsear                                    â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Verificar JSON vÃ¡lido                              â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Filtrar Ã¡reas no vÃ¡lidas                           â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â€¢ Validar longitud de resumen                        â”‚       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                        â”‚                                           â”‚   â”‚
â”‚  â”‚                        â–¼                                           â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚     â”‚ Actualizar Firestore                                 â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ UPDATE documento SET:                                â”‚       â”‚   â”‚
â”‚  â”‚     â”‚   areas_detectadas = ["fiscal", "laboral"]           â”‚       â”‚   â”‚
â”‚  â”‚     â”‚   resumen_ia = "Se reforman disposiciones..."        â”‚       â”‚   â”‚
â”‚  â”‚     â”‚   procesado = true                                   â”‚       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚     â¸ï¸  Pausa 1 segundo (rate limiting)                             â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“Š OUTPUT: 47 documentos clasificados y resumidos                          â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  ğŸ“§ FASE 3: MATCHING Y ENVÃO DE EMAILS                                      â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                    â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3.1 Query Usuarios Activos                                          â”‚   â”‚
â”‚  â”‚     WHERE status = 'active'                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                               â”‚
â”‚                            â–¼                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 3.2 Para cada usuario:                                              â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚     â”‚ Obtener Ãreas del Usuario                            â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Query: areas_usuario                                 â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ WHERE usuario_id = user.id                           â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Resultado: ["fiscal", "laboral", "mercantil"]        â”‚       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                        â”‚                                           â”‚   â”‚
â”‚  â”‚                        â–¼                                           â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚     â”‚ Obtener Documentos del DÃ­a                           â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Query: documentos_dof                                â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ WHERE fecha_publicacion = HOY                        â”‚       â”‚   â”‚
â”‚  â”‚     â”‚   AND procesado = true                               â”‚       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                        â”‚                                           â”‚   â”‚
â”‚  â”‚                        â–¼                                           â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚     â”‚ Matching: Filtrar Documentos Relevantes              â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Usuario tiene: ["fiscal", "laboral"]                 â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Doc A: ["fiscal", "mercantil"]     â†’ âœ… MATCH        â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Doc B: ["ambiental"]               â†’ âŒ NO MATCH     â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Doc C: ["laboral", "constitucional"] â†’ âœ… MATCH      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ Resultado: 2 documentos relevantes                   â”‚       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                        â”‚                                           â”‚   â”‚
â”‚  â”‚                        â–¼                                           â”‚   â”‚
â”‚  â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚     â”‚ Si hay documentos relevantes:                        â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ Generar Email HTML                             â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚                                                â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ â€¢ Header con logo                              â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ â€¢ Saludo personalizado                         â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ â€¢ Contador de documentos                       â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ â€¢ Para cada documento:                         â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚   - Badges de Ã¡reas (con emoji)                â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚   - TÃ­tulo completo                            â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚   - Resumen de IA (2-3 oraciones)              â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚   - Tipo y ediciÃ³n                             â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚   - Link al DOF oficial                        â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ â€¢ Footer con cancelaciÃ³n                       â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                  â”‚                                   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                  â–¼                                   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ Enviar con Resend                              â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚                                                â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ From: alertas@lawgic.com                       â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ To: usuario@despacho.com                       â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ Subject: "DOF Alertas - 13/12/25 - 2 docs"    â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ HTML: [email generado]                         â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚                                                â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ Tiempo: <1 segundo                             â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ Costo: $0.001                                  â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                  â”‚                                   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                  â–¼                                   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ Registrar en alertas_enviadas                  â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚                                                â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚ Para cada documento:                           â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚   - usuario_id                                 â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚   - documento_id                               â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚   - email_id (de Resend)                       â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â”‚   - fecha_envio                                â”‚   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚       â”‚   â”‚
â”‚  â”‚     â”‚                                                      â”‚       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â”‚                                                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  ğŸ“Š OUTPUT: Emails enviados a usuarios con documentos relevantes            â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                             â”‚
â”‚  âœ… JOB COMPLETADO                                                          â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                                          â”‚
â”‚                                                                             â”‚
â”‚  Response JSON:                                                             â”‚
â”‚  {                                                                          â”‚
â”‚    "success": true,                                                         â”‚
â”‚    "documentos_encontrados": 47,                                            â”‚
â”‚    "documentos_procesados": 47,                                             â”‚
â”‚    "emails_enviados": 23                                                    â”‚
â”‚  }                                                                          â”‚
â”‚                                                                             â”‚
â”‚  Logs:                                                                      â”‚
â”‚  === Job completado: 23 emails enviados ===                                 â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Flujo de Datos Simplificado

```
DOF Website
    â”‚
    â”‚ HTTP GET
    â–¼
HTML Page (47 docs)
    â”‚
    â”‚ Cheerio Parse
    â–¼
Raw Documents
    â”‚
    â”‚ Extract Content
    â–¼
Documents + Extractos
    â”‚
    â”‚ Save to Firestore
    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  documentos_dof     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ titulo           â”‚
â”‚  â€¢ url_dof          â”‚
â”‚  â€¢ extracto         â”‚
â”‚  â€¢ procesado: false â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Query (procesado = false)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Claude 3.5 Haiku   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Input: TÃ­tulo +    â”‚
â”‚         Extracto    â”‚
â”‚                     â”‚
â”‚  Output: {          â”‚
â”‚    areas: [...],    â”‚
â”‚    resumen: "..."   â”‚
â”‚  }                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Update Firestore
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  documentos_dof     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ areas_detectadas â”‚
â”‚  â€¢ resumen_ia       â”‚
â”‚  â€¢ procesado: true  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Query (fecha = HOY, procesado = true)
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Matching Engine    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Usuario A:         â”‚
â”‚    areas: [fiscal]  â”‚
â”‚    â†’ 3 docs         â”‚
â”‚                     â”‚
â”‚  Usuario B:         â”‚
â”‚    areas: [laboral] â”‚
â”‚    â†’ 5 docs         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Generate HTML + Send
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Resend             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Email to:          â”‚
â”‚  â€¢ usuarioA@...     â”‚
â”‚  â€¢ usuarioB@...     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Log
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  alertas_enviadas   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â€¢ usuario_id       â”‚
â”‚  â€¢ documento_id     â”‚
â”‚  â€¢ email_id         â”‚
â”‚  â€¢ fecha_envio      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Arquitectura de Base de Datos

```
Firestore Collections:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  usuarios                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚  â€¢ id (auto)                                                 â”‚
â”‚  â€¢ email                                                     â”‚
â”‚  â€¢ nombre                                                    â”‚
â”‚  â€¢ status: "active" | "canceled" | "past_due"                â”‚
â”‚  â€¢ stripe_customer_id                                        â”‚
â”‚  â€¢ stripe_subscription_id                                    â”‚
â”‚  â€¢ created_at                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ 1:N
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  areas_usuario                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚  â€¢ id (auto)                                                 â”‚
â”‚  â€¢ usuario_id â†’ usuarios.id                                  â”‚
â”‚  â€¢ area_codigo: "fiscal" | "laboral" | ...                   â”‚
â”‚  â€¢ created_at                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  documentos_dof                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                             â”‚
â”‚  â€¢ id (auto)                                                 â”‚
â”‚  â€¢ fecha_publicacion: "2025-12-13"                           â”‚
â”‚  â€¢ titulo                                                    â”‚
â”‚  â€¢ tipo_documento: "Decreto" | "Acuerdo" | ...               â”‚
â”‚  â€¢ url_dof                                                   â”‚
â”‚  â€¢ contenido_extracto (2000 chars)                           â”‚
â”‚  â€¢ edicion: "Matutina" | "Vespertina" | "Extraordinaria"     â”‚
â”‚  â€¢ areas_detectadas: ["fiscal", "laboral"]                   â”‚
â”‚  â€¢ resumen_ia                                                â”‚
â”‚  â€¢ procesado: boolean                                        â”‚
â”‚  â€¢ created_at                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ N:M (via alertas_enviadas)
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  alertas_enviadas                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚  â€¢ id (auto)                                                 â”‚
â”‚  â€¢ usuario_id â†’ usuarios.id                                  â”‚
â”‚  â€¢ documento_id â†’ documentos_dof.id                          â”‚
â”‚  â€¢ email_id (Resend)                                         â”‚
â”‚  â€¢ fecha_envio                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Timeline de EjecuciÃ³n

```
06:00 AM  DOF publica documentos del dÃ­a
          â”‚
          â”‚
07:00 AM  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Vercel Cron ejecuta job            â”‚
          â”‚ POST /api/jobs/daily               â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
07:00-    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
07:03 AM  â”‚ FASE 1: Scraping                   â”‚
          â”‚ â€¢ Descargar HTML del DOF           â”‚
          â”‚ â€¢ Extraer 47 documentos            â”‚
          â”‚ â€¢ Obtener contenido completo       â”‚
          â”‚ â€¢ Guardar en Firestore             â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
07:03-    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
07:06 AM  â”‚ FASE 2: ClasificaciÃ³n con IA       â”‚
          â”‚ â€¢ Procesar 47 documentos           â”‚
          â”‚ â€¢ Claude analiza cada uno          â”‚
          â”‚ â€¢ ~2-3 seg/doc + 1 seg pausa       â”‚
          â”‚ â€¢ Total: ~3 minutos                â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
07:06-    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
07:07 AM  â”‚ FASE 3: Matching y EnvÃ­o           â”‚
          â”‚ â€¢ Query usuarios activos           â”‚
          â”‚ â€¢ Filtrar docs relevantes          â”‚
          â”‚ â€¢ Generar emails HTML              â”‚
          â”‚ â€¢ Enviar vÃ­a Resend                â”‚
          â”‚ â€¢ Total: ~1 minuto                 â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
07:07 AM  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ Job completado                     â”‚
          â”‚ Response: 200 OK                   â”‚
          â”‚ {                                  â”‚
          â”‚   documentos_encontrados: 47,      â”‚
          â”‚   documentos_procesados: 47,       â”‚
          â”‚   emails_enviados: 23              â”‚
          â”‚ }                                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**DuraciÃ³n total**: ~7 minutos
**Usuarios reciben emails**: 7:07 AM (al llegar a la oficina)

---

## Decisiones de Arquitectura

### Â¿Por quÃ© Firestore y no PostgreSQL?

| Aspecto | Firestore | PostgreSQL |
|---------|-----------|------------|
| **Escalabilidad** | AutomÃ¡tica | Manual |
| **Costo inicial** | $0 (50K reads/dÃ­a) | $5-20/mes |
| **Queries complejas** | Limitadas | Ilimitadas |
| **Transacciones** | Limitadas | ACID completo |
| **Setup** | 5 minutos | 1 hora |
| **Mantenimiento** | Cero | Alto |

**DecisiÃ³n**: Firestore para MVP, migrar a PostgreSQL si se necesitan queries complejas.

### Â¿Por quÃ© Claude y no GPT-4?

| Aspecto | Claude 3.5 Haiku | GPT-4 Turbo |
|---------|------------------|-------------|
| **Costo** | $0.006/doc | $0.03/doc |
| **Velocidad** | 2-3 seg | 5-8 seg |
| **PrecisiÃ³n** | 90% | 92% |
| **JSON nativo** | SÃ­ | SÃ­ |
| **Contexto** | 200K tokens | 128K tokens |

**DecisiÃ³n**: Claude por costo y velocidad. Diferencia de precisiÃ³n (2%) no justifica 5x costo.

### Â¿Por quÃ© Resend y no SendGrid?

| Aspecto | Resend | SendGrid |
|---------|--------|----------|
| **Costo** | $0.001/email | $0.01/email |
| **Deliverability** | 99%+ | 98%+ |
| **API** | Simple | Compleja |
| **Setup** | 10 min | 1 hora |
| **Analytics** | BÃ¡sico | Avanzado |

**DecisiÃ³n**: Resend por simplicidad y costo. Migrar a SendGrid si se necesitan analytics avanzados.

---

**Ãšltima actualizaciÃ³n**: 13 de diciembre de 2025
